(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{1029:(e,a,t)=>{Promise.resolve().then(t.bind(t,35399))},35399:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>I});var r=t(95155),l=t(12115),n=t(28633),i=t(71226),s=t(23817),o=t(14505),d=t(30098),c=t(32423),m=t(48251),g=t(40767);t(35007);var x=t(14085),u=t(29602);t(88680);var h=t(25739),p=t(76046),f=t(81826),y=t(14640),b=t(37310),v=t(30814),w=t(447),j=t(94640),k=t(64104),N=t(20016),S=t(35901),C=t(8807);function I(){let e;let{loading:a,companyId:t,dbUser:I,refreshAuth:E}=(0,S.A)(),[_,F]=(0,l.useState)("IDLE"),[A,R]=(0,l.useState)(null),[D,P]=(0,l.useState)(!1),[T,L]=(0,l.useState)(null),[M,z]=(0,l.useState)([]),[B,O]=(0,l.useState)(""),[V,U]=(0,l.useState)(!1),[G,$]=(0,l.useState)(!1),[W,H]=(0,l.useState)(!1),[K,Y]=(0,l.useState)(!0),[q,X]=(0,l.useState)(!1),[J,Q]=(0,l.useState)(null),[Z,ee]=(0,l.useState)(null),[ea,et]=(0,l.useState)({name:"",phone:"",linkedin:"",role:"",department:""}),[er,el]=(0,l.useState)(!1),[en,ei]=(0,l.useState)(!1),[es,eo]=(0,l.useState)(!0),[ed,ec]=(0,l.useState)(!1),[em,eg]=(0,l.useState)(null),[ex,eu]=(0,l.useState)("composer"),[eh,ep]=(0,l.useState)(null),[ef,ey]=(0,l.useState)(!0),[eb,ev]=(0,l.useState)(!1),ew=(0,p.useSearchParams)();(0,p.useRouter)();let[ej,ek]=(0,l.useState)([]),[eN,eS]=(0,l.useState)(!1),[eC,eI]=(0,l.useState)(0),[eE,e_]=(0,l.useState)(!0);ej.length>0&&ej[0];let eF=!!((null==I?void 0:I.full_name)&&(null==I?void 0:I.contact_number)&&(null==I?void 0:I.designation)&&(null==I?void 0:I.team)&&(null==I?void 0:I.linkedin_profile)),[eA,eR]=(0,l.useState)(!1),[eD,eP]=(0,l.useState)(3);(0,l.useEffect)(()=>{if(eF){if(eA){eP(3);let e=setInterval(()=>{eP(a=>a<=1?(clearInterval(e),ey(!1),0):a-1)},1e3);return()=>clearInterval(e)}ey(!1)}},[eF,eA]);let eT=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;if(!a&&t)try{eS(!0);let a=await h.F.get("/intelligence/campaigns?limit=".concat(l,"&offset=").concat(e));if(r)ek(e=>[...e,...a.campaigns]);else{ek(a.campaigns),a.campaigns.length>0&&a.campaigns[0];let e={name:(null==I?void 0:I.full_name)||"",phone:(null==I?void 0:I.contact_number)||"",role:(null==I?void 0:I.designation)||"",department:(null==I?void 0:I.team)||"",linkedin:(null==I?void 0:I.linkedin_profile)||""};et({name:e.name,phone:e.phone,role:e.role,department:e.department,linkedin:e.linkedin}),e.name&&e.phone&&e.role&&e.department&&e.linkedin&&el(!0)}e_(a.campaigns.length>=l);let t=a.campaigns.length;r?eI(e=>e+t):eI(t)}catch(e){console.error("Failed to fetch campaigns:",e),v.oR.error("Failed to load campaign history")}finally{eS(!1),eo(!1)}};(0,l.useEffect)(()=>{!a&&t&&eT()},[a,t]),(0,l.useEffect)(()=>{if(!a&&t){let e=setInterval(()=>{if("visible"===document.visibilityState){let e=ej.length;eT(0,!1,e>0?e:3)}},15e3);return()=>clearInterval(e)}},[a,t,ej.length]);let eL=()=>{eT(eC,!0)},eM=async e=>{try{await h.F.delete("/intelligence/campaigns/".concat(e)),ek(a=>a.filter(a=>a.id!==e)),v.oR.success("Campaign deleted successfully")}catch(e){throw console.error("Failed to delete campaign:",e),v.oR.error(e.message||"Failed to delete campaign"),e}},ez=async e=>{try{await h.F.post("/intelligence/campaigns/".concat(e,"/archive"),{}),ek(a=>a.filter(a=>a.id!==e)),eh===e&&ep(null),v.oR.success("Campaign archived successfully")}catch(e){throw console.error("[Dashboard] Failed to archive campaign:",e),v.oR.error(e.message||"Failed to archive campaign"),e}};(0,l.useEffect)(()=>{"COMPLETED"===_&&Z&&eT(0,!1,ej.length+1)},[_,Z]),(0,l.useEffect)(()=>{eh&&setTimeout(()=>{let e=document.getElementById("campaign-card-".concat(eh)),a=document.getElementById("customer-intelligence-scroll-container");if(e&&a){let t=e.getBoundingClientRect().top,r=a.getBoundingClientRect().top,l=a.scrollTop;a.scrollTo({top:l+(t-r)+-20,behavior:"smooth"})}else e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)},[eh]);let eB=async()=>{if(!a&&t)try{let e=await h.F.get("/intelligence/calendar/status");P(e.connected),L(e)}catch(e){console.error("Failed to fetch calendar status:",e)}finally{Y(!1)}};(0,l.useEffect)(()=>{!a&&t&&eB()},[a,t]),(0,l.useEffect)(()=>{let e=setInterval(()=>{!a&&t&&eB()},1e4);return()=>clearInterval(e)},[a,t]),(0,l.useEffect)(()=>{(null==ew?void 0:ew.get("calendar_connected"))==="true"&&!a&&t&&eB()},[ew,a,t]);let eO=async()=>{try{if($(!0),!localStorage.getItem("unclutr_company_id")){console.error("Missing unclutr_company_id in localStorage"),v.oR.error("Session error: Please try refreshing the page or logging in again."),$(!1);return}let e=await h.F.get("/intelligence/calendar/google/login");if(e.url)window.location.href=e.url;else throw Error("Invalid response from server")}catch(e){console.error("Failed to start Google OAuth:",e),v.oR.error("Failed to connect calendar: ".concat(e.message||"Unknown error")),$(!1)}},[eV,eU]=(0,l.useState)({name:"",phone:"",linkedin:"",role:"",department:""}),eG=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!1===e||!ea.name.trim()||ea.role.trim().length<2||ea.department.trim().length<2){el(!1);return}try{ei(!0),await h.F.post("/intelligence/campaigns/onboarding",{name:ea.name,phone_number:ea.phone,linkedin:ea.linkedin,team_member_role:ea.role,team_member_department:ea.department}),el(!0),eR(!0),eU({...ea}),v.oR.success("Identity Verified. Customer Intelligence Unlocked.");try{await E()}catch(e){console.warn("Failed to refresh auth after contact save:",e)}setTimeout(()=>{eT(0,!1,ej.length+1)},1e3)}catch(t){var a;console.error("Failed to save contact details:",t),el(!1);let e=(null==t?void 0:t.message)||(null==t?void 0:null===(a=t.data)||void 0===a?void 0:a.detail)||"Failed to save contact details. Please try again.";v.oR.error(e)}finally{ei(!1)}};e=25,eF&&(e+=25),D&&(e+=25),"REVIEW"===_&&(e+=25);let e$=async()=>{try{H(!0),await h.F.delete("/intelligence/calendar/disconnect"),P(!1),L(null),U(!1),v.oR.success("Calendar disconnected successfully")}catch(e){console.error("Failed to disconnect calendar:",e),v.oR.error("Failed to disconnect calendar: ".concat(e.message||"Unknown error"))}finally{H(!1)}},eW=async e=>{let a=null==Z?void 0:Z.id;if(!a&&ej.length>0&&(a=ej[0].id),!a){v.oR.error("No active campaign found. Please start a campaign first.");return}try{await h.F.post("/intelligence/campaigns/".concat(a,"/windows"),e),v.oR.success("Execution window blocked & synced to calendar!");let t=await h.F.get("/intelligence/campaigns/".concat(a));ee(t),eB()}catch(e){var t;console.error("Failed to save window:",e),(null===(t=e.response)||void 0===t?void 0:t.status)===404||404===e.status||e.message&&e.message.includes("not found")?(v.oR.error("Campaign not found. Refreshing your list..."),await eT(0,!1,Math.max(ej.length,3)),(null==Z?void 0:Z.id)===a&&ee(null)):v.oR.error(e.message||"Failed to save execution window")}};return(0,r.jsx)("div",{id:"customer-intelligence-scroll-container",className:"p-6 md:p-8 h-[calc(100vh-4rem)] flex flex-col overflow-y-auto scrollbar-hide",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto w-full flex-1 flex flex-col",children:[(0,r.jsx)(n.N,{mode:"wait",children:es?(0,r.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex-1 flex items-center justify-center min-h-[400px]",children:(0,r.jsx)(b.h,{text:"Establishing Secure Connection..."})},"loading"):!eF||ef?(0,r.jsxs)(i.P.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.02,filter:"blur(10px)"},transition:{duration:.5,ease:"easeInOut"},onClick:()=>ey(!1),className:"flex-1 relative flex flex-col items-center justify-center max-w-lg mx-auto w-full min-h-[60vh] cursor-pointer",children:[(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[1000px] h-[1000px] bg-gradient-radial from-orange-500/10 via-transparent to-transparent blur-[120px] pointer-events-none transition-opacity duration-1000"}),(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-gradient-radial from-emerald-500/5 via-transparent to-transparent blur-[80px] pointer-events-none transition-opacity duration-1000"}),(0,r.jsxs)("div",{className:"relative z-10 text-center mb-8 space-y-4",children:[(0,r.jsxs)(i.P.div,{initial:{y:0},animate:{y:[0,-8,0]},transition:{repeat:1/0,duration:6,ease:"easeInOut"},className:"inline-flex items-center justify-center w-24 h-24 rounded-[2.5rem] bg-gradient-to-br from-white to-gray-50 dark:from-zinc-900 dark:to-black text-gray-900 dark:text-white shadow-2xl shadow-orange-500/20 mb-6 backdrop-blur-xl ring-1 ring-gray-200 dark:ring-white/10 relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-white/40 dark:bg-white/5 rounded-[2.5rem] animate-pulse"}),(0,r.jsx)(s.A,{className:"w-10 h-10 text-orange-500 drop-shadow-[0_0_15px_rgba(249,115,22,0.4)] relative z-10"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-b from-gray-900 via-gray-800 to-gray-600 dark:from-white dark:to-gray-400 tracking-tighter mb-2",children:"Identity Verification"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-sm leading-relaxed max-w-md mx-auto font-medium",children:"Before granting access to the Intelligence Engine, please verify your identity and operational role."})]})]}),(0,r.jsx)(j.$,{contactDetails:ea,onChange:(e,a)=>{et(t=>({...t,[e]:a}))},isSaved:er,isLoading:en,onSave:eG,className:"relative z-10 w-full"}),eF&&(0,r.jsx)(i.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"relative z-10 mt-6 text-center",children:(0,r.jsxs)("p",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest bg-white/50 dark:bg-black/50 px-4 py-2 rounded-full backdrop-blur-md border border-white/10 inline-flex items-center gap-2",children:[(0,r.jsx)(o.A,{className:"w-3 h-3 animate-spin text-emerald-500"}),"Redirecting to Dashboard in ",(0,r.jsx)("span",{className:"text-emerald-500 font-mono text-xs",children:eD}),"s"]})})]},"verification"):(0,r.jsxs)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"w-full space-y-12",children:[(0,r.jsxs)("div",{className:"text-center space-y-3 py-8",children:[(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md bg-gray-50 dark:bg-white/[0.03] border border-gray-200/50 dark:border-white/[0.06]",children:[(0,r.jsx)(d.A,{className:"w-3.5 h-3.5 text-orange-500"}),(0,r.jsx)("span",{className:"text-[11px] font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Intelligence Engine"})]}),(0,r.jsx)("h1",{className:"text-4xl md:text-5xl font-semibold text-gray-900 dark:text-white tracking-tight",children:"Customer Intelligence Lab"}),(0,r.jsx)("p",{className:"text-base text-gray-500 dark:text-gray-400 max-w-2xl mx-auto leading-relaxed",children:"Upload your leads, and watch our AI conduct personalized discovery calls. Get deep customer insights and tailored campaign strategiesâ€”automatically."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 lg:gap-6",children:[(0,r.jsx)("div",{className:"lg:col-span-3",children:(0,r.jsx)(k.K,{className:"h-full min-h-[400px] shadow-sm border-gray-200/80 dark:border-white/[0.08]",onSuccess:()=>{eT(0,!1,ej.length+1)},isMagicUI:C.$.IS_MAGIC_AI_ENABLED})}),(0,r.jsxs)("div",{className:"relative group rounded-[2.5rem] overflow-hidden flex flex-col h-auto self-start",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-white dark:bg-zinc-900/50 border border-gray-200/80 dark:border-white/[0.08] transition-all duration-200 group-hover:border-gray-300 dark:group-hover:border-white/[0.12] rounded-[2.5rem]"}),(0,r.jsxs)("div",{className:"relative p-6 flex flex-col h-full z-10",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-white/[0.06] text-gray-600 dark:text-gray-400 mt-0.5",children:(0,r.jsx)(c.A,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-1.5 leading-none",children:"Calendar Access"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-0 leading-relaxed max-w-[140px]",children:"Sync schedule to block execution windows."})]})]}),(0,r.jsxs)("div",{className:(0,u.cn)("px-2.5 py-1 rounded-full text-[10px] font-bold border flex items-center gap-1.5 shrink-0",D?"bg-emerald-50 text-emerald-600 border-emerald-200/50 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20":"bg-gray-50 text-gray-400 border-gray-200/50 dark:bg-white/[0.03] dark:border-white/[0.06]"),children:[(0,r.jsx)("div",{className:(0,u.cn)("w-1.5 h-1.5 rounded-full",D?"bg-emerald-500 animate-pulse":"bg-gray-400")}),D?"ACTIVE":"OFFLINE"]})]}),K||G||W?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsx)(b.h,{text:G?"Connecting...":"Syncing..."})}):D?(0,r.jsxs)("div",{className:"flex flex-col flex-1 space-y-6",children:[(0,r.jsxs)("div",{className:"p-3 rounded-2xl bg-emerald-50 dark:bg-emerald-500/5 border border-emerald-200/50 dark:border-emerald-500/10 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),(0,r.jsx)("span",{className:"text-[11px] font-semibold text-emerald-700 dark:text-emerald-400",children:"Google Calendar"})]}),(0,r.jsx)(x.$,{variant:"ghost",size:"icon",onClick:()=>{U(!0)},className:"w-6 h-6 text-gray-400 hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-500/10 rounded-full transition-colors",children:(0,r.jsx)(g.A,{className:"w-3.5 h-3.5"})})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-400",children:"24H Availability"}),(0,r.jsx)("button",{onClick:()=>X(!0),className:"text-[10px] text-blue-500 hover:text-blue-600 font-semibold",children:"View Week"})]}),(0,r.jsx)("div",{className:"grid grid-cols-8 gap-1 p-2.5 bg-gray-50 dark:bg-white/[0.02] rounded-lg border border-gray-200/50 dark:border-white/[0.06] cursor-pointer hover:border-gray-300 dark:hover:border-white/[0.1] transition-colors",onClick:()=>X(!0),title:"View Full Week",children:(()=>{let e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());return Array.from({length:18}).map((e,t)=>{let r=new Date(a.getTime()+36e5*t),l=new Date(a.getTime()+(t+1)*36e5);return{isBusy:((null==T?void 0:T.busy_slots)||[]).some(e=>{let a=new Date(e.start).getTime(),t=new Date(e.end).getTime();return a<l.getTime()&&t>r.getTime()}),key:t}}).map(e=>(0,r.jsx)("div",{className:(0,u.cn)("aspect-square rounded-full transition-all duration-300",e.isBusy?"bg-rose-500/70":"bg-emerald-500/20")},e.key))})()})]})]}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)(x.$,{onClick:eO,className:"w-full rounded-2xl h-10 bg-gray-900 dark:bg-white hover:bg-gray-800 dark:hover:bg-gray-100 text-white dark:text-gray-900 text-xs font-semibold transition-all shadow-lg",children:["Connect Google",(0,r.jsx)(m.A,{className:"w-3.5 h-3.5 ml-1.5 opacity-50"})]})})]})]})]}),(0,r.jsxs)("div",{id:"latest-campaigns",className:"pt-8 border-t border-gray-100 dark:border-white/[0.05]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Latest campaigns"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Monitor and manage your active intelligence campaigns."})]}),ej.length>0&&eE&&(0,r.jsx)(x.$,{variant:"ghost",onClick:()=>eL(),disabled:eN,className:"text-xs font-medium text-gray-500 hover:text-gray-900 dark:hover:text-white h-8",children:eN?"Loading...":"View More"})]}),0!==ej.length||eN?(0,r.jsx)(i.P.div,{layout:!0,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:(0,r.jsx)(n.N,{children:Array.from(new Map(ej.map(e=>[e.id,e])).values()).map((e,a)=>{let t=eh===e.id;return(0,r.jsx)(i.P.div,{layout:!0,transition:{layout:{duration:.5,type:"spring",stiffness:100,damping:20}},id:"campaign-card-".concat(e.id),className:(0,u.cn)(t?"col-span-1 md:col-span-2 lg:col-span-3 order-first":"col-span-1"),children:(0,r.jsx)(w.p,{campaign:e,variant:"summary",isExpanded:t,onToggleExpand:()=>ep(t?null:e.id),onDelete:eM,onArchive:ez,onEditClick:e=>{eg(e),eu("composer"),ec(!0)},onClick:()=>!t&&ep(e.id),onStartCampaign:()=>{window.location.href="/dashboard-new/customer-intelligence/campaign/".concat(e.id)}})},e.id||a)})})}):(0,r.jsxs)("div",{className:"py-20 rounded-xl border border-dashed border-gray-200 dark:border-white/[0.08] bg-gray-50/50 dark:bg-white/[0.01] flex flex-col items-center justify-center text-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-100 dark:bg-white/[0.05] flex items-center justify-center mb-4",children:(0,r.jsx)(d.A,{className:"w-5 h-5 text-gray-400"})}),(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-1",children:"No campaigns yet"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 max-w-[200px] leading-relaxed",children:"Your generated interview strategies will appear here."})]}),eN&&(0,r.jsx)("div",{className:"w-full flex justify-center py-8",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})})]}),!1]},"dashboard")}),(0,r.jsx)(f.T,{isOpen:V,onClose:()=>U(!1),onConfirm:e$,isLoading:W}),(0,r.jsx)(y.z,{isOpen:q,onClose:()=>X(!1),busySlots:(null==T?void 0:T.busy_slots)||[],activeCampaign:Z||(ej.length>0?ej[0]:null),onSaveWindow:eW}),(0,r.jsx)(n.N,{children:ed&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 md:p-8",children:(0,r.jsx)(i.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"w-full max-w-4xl",children:"leads"===ex?(0,r.jsx)(k.K,{mode:"edit",campaignId:em,onLeadsUpdated:()=>{eT(0,!1,ej.length+1),eu("composer")},onCancel:()=>ec(!1),className:"h-full shadow-2xl"}):(0,r.jsx)(N.X,{campaignId:em,isMagicUI:C.$.IS_MAGIC_AI_ENABLED,onComplete:()=>{eT(0,!1,ej.length+1),ec(!1)},onBack:()=>{eT(0,!1,Math.max(ej.length,3)),ec(!1)},onEditLeads:()=>eu("leads"),className:"h-full shadow-2xl"},"composer-".concat(em,"-").concat(ex))})})})]})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[5563,3524,586,1431,1226,24,763,4158,814,9943,7641,1053,6374,1877,9022,9213,5901,8804,2324,8356,5101,8441,1517,7358],()=>a(1029)),_N_E=e.O()}]);